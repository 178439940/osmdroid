<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2016-02-23 
 | Rendered using Apache Maven Fluido Skin 1.4
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="Date-Creation-yyyymmdd" content="20080101"/>
    <meta name="Date-Revision-yyyymmdd" content="20180218"/>
    <meta http-equiv="Content-Language" content="en"/>
    <title> osmdroid</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.4.min.css"/>
    <link rel="stylesheet" href="./css/site.css"/>
    <link rel="stylesheet" href="./css/print.css" media="print"/>

    <link rel="stylesheet" type="text/css" href="./css/bootstrap-sortable.css">


    <script type="text/javascript" src="./js/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="./js/apache-maven-fluido-1.4.min.js"></script>
    <script type="text/javascript" src="./js/bootstrap-sortable.js"></script>
    <script type="text/javascript" src="./js/moment.min.js"></script>
</head>
<body class="topBarDisabled">

<a href="https://github.com/osmdroid/osmdroid">
    <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
    src="./img/forkme_right_gray_6d6d6d.png"
    alt="Fork me on GitHub">
    </a>


<div class="container-fluid">
    <div id="banner">
        <div class="pull-left">
            <div id="bannerLeft">
                <h2> osmdroid</h2>
            </div>
        </div>
        <div class="pull-right">
            <div id="bannerRight">
                <!-- override this with your own logo-->
                <img src="./img/logo.png"/>
            </div>
        </div>
        <div class="clear">
            <hr/>
        </div>
    </div>

    <div id="breadcrumbs">
        <ul class="breadcrumb">

            <li class="">
                <a href="https://github.com/osmdroid/" class="externalLink" title="org.osmdroid">
                    org.osmdroid</a>
                <span class="divider">/</span>
            </li>
            <li class="">
                <a href="https://github.com/osmdroid/osmdroid" class="externalLink" title="osmdroid">
                    osmdroid</a>

            </li>

            <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published:
                2018-02-18
            </li>
            <li id="projectVersion" class="pull-right">
                6.0.1
            </li>

        </ul>
    </div>


    <div class="row-fluid">
        <div id="leftColumn" class="span2">
            <div class="well sidebar-nav">


                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>

                    <li  >

                        <a href="index.html"><span class="none"></span>Introduction</a>
                    </li>

                    <!-- user generated menu goes here, basically any additional html or markdown files
                    from src/site are auto linked here-->

					<li><a href="Home.html" title="Home"><span class="none"></span>Home</a>
						<ul class="nav nav-list">
							<li><a href="How-to-include-OsmDroid-in-a-Maven-Android-project.html" title="How   to   include   Osm Droid   in   a   Maven   Android   project"><span class="none"></span>How   to   include   Osm Droid   in   a   Maven   Android   project</a></li> 
							<li><a href="How-to-include-OsmDroid-in-a-non-Gradle,-non-Maven-project.html" title="How   to   include   Osm Droid   in   a   non   Gradle ,   non   Maven   project"><span class="none"></span>How   to   include   Osm Droid   in   a   non   Gradle ,   non  Maven   project</a></li> 
							<li><a href="Prerequisites.html" title="Prerequisites"><span class="none"></span>Prerequisites</a></li> 
							<li><a href="How-to-use-the-osmdroid-library.html" title="How   to   use   the   osmdroid   library"><span class="none"></span>How   to   use   the   osmdroid   library</a></li> 
						</ul>
					</li>                    
					
					 <li class="nav-header"><span class="icon-chevron-down"></span>Usage Guides</li>
					 <li>
						<ul class="nav nav-list">
							<li><a href="How-to-use-the-osmdroid-library.html" title="How   to   use   the   osmdroid   library"><span class="none"></span>How   to   use   the   osmdroid   library</a></li>  
							<li><a href="Markers,-Lines-and-Polygons.html" title="Markers ,   Lines   and   Polygons"><span class="none"></span>Markers ,   Lines   and   Polygons</a></li> 
							<li><a href="Geopackage-Support.html" title="Geopackage   Support"><span class="none"></span>Geopackage   Support</a></li> 
							<li><a href="Cache-Manager.html" title="Cache   Manager"><span class="none"></span>Cache   Manager</a></li> 
							<li><a href="WMS-Support.html" title="WMS   Support"><span class="none"></span>WMS   Support</a></li>	
							<li><a href="Tile-Caching.html" title="Tile   Caching"><span class="none"></span>Tile   Caching</a></li> 
							<li><a href="osmdroid-thirdparty.html" title="Osmdroid   thirdparty"><span class="none"></span>Osmdroid   thirdparty</a></li> 
							<li><a href="Mapsforge.html" title="Mapsforge"><span class="none"></span>Mapsforge</a></li> 
						 </ul>
					 </li>
					 
					<li class="nav-header"><span class="icon-chevron-down"></span>Upgrades and Changes</li>
					 <li>
						<ul class="nav nav-list">
							<li><a href="Upgrade-Guide.html" title="Upgrade   Guide"><span class="none"></span>Upgrade   Guide</a></li> 
							<li><a href="Changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li> 
						 </ul>
					 </li>

				     <li class="nav-header"><span class="icon-chevron-down"></span>Architecture and Design</li>
					 <li>
						<ul class="nav nav-list">
							<li><a href="Modular-Tile-Provider-Architecture.html" title="Modular   Tile   Provider   Architecture"><span class="none"></span>Modular   Tile   Provider   Architecture</a></li> 
							<li><a href="Map-Sources.html" title="Map   Sources"><span class="none"></span>Map   Sources</a></li> 
							<li><a href="Offline-Map-Tiles.html" title="Offline   Map   Tiles"><span class="none"></span>Offline   Map   Tiles</a></li> 	
						</ul>
					</li>
					 
					 
					<li class="nav-header"><span class="icon-chevron-down"></span>Q&A</li>
					 <li>
						<ul class="nav nav-list">
							<li><a href="How-big-is-it.html" title="How   big   is   it"><span class="none"></span>How   big   is   it</a></li> 
							<li><a href="Capabilities.html" title="Capabilities"><span class="none"></span>Capabilities</a></li> 
							<li><a href="Important-notes-on-using-osmdroid-in-your-app.html" title="Important   notes   on   using   osmdroid   in   your   app"><span class="none"></span>Important   notes   on   using   osmdroid   in   your   app</a></li> 
							<li><a href="FAQ.html" title="FAQ"><span class="none"></span>FAQ</a></li> 
						</ul>
					 </li>
					 
					<li class="nav-header"><span class="icon-chevron-down"></span>Other Information</li>
					 <li>
						<ul class="nav nav-list">
							<li><a href="Applications-Using-osmdroid.html" title="Applications Using osmdroid"><span class="none"></span>Applications   Using   osmdroid</a></li> 
							<li><a href="Related-Projects.html" title="Related   Projects"><span class="none"></span>Related   Projects</a></li>
						 </ul>
					 </li>
					
					<li class="nav-header"><span class="icon-chevron-down"></span>Committer Notes</li>
					 <li>
							<ul class="nav nav-list">
								<li><a href="Developer-Guidelines.html" title="Developer   Guidelines"><span class="none"></span>Developer   Guidelines</a></li> 
								<li><a href="How-to-build-osmdroid-from-source.html" title="How   to   build   osmdroid   from   source"><span class="none"></span>How   to   build   osmdroid   from   source</a></li> 
								<li><a href="Debugging-osmdroid.html" title="Debugging   osmdroid"><span class="none"></span>Debugging   osmdroid</a></li> 
								<li><a href="Release-Procedure.html" title="Release   Procedure"><span class="none"></span>Release   Procedure</a></li> 
							 </ul>
					 </li>
 
                    <li class="nav-header">Project Documentation</li>

                    <li>

                        <a href="project-info.html" title="Project Information">
                            <span class="icon-chevron-down"></span>
                            Project Information</a>
                        <ul class="nav nav-list">

                            <li>

                                <a href="team-list.html" title="Project Team">
                                    <span class="none"></span>
                                    Project Team</a>
                            </li>

                            <li>

                                <a href="scm:git:git@github.com:osmdroid/osmdroid.git" title="Source Repository">
                                    <span class="none"></span>
                                    Source Repository</a>
                            </li>

                            <li>

                                <a href="https://github.com/osmdroid/osmdroid/issues" title="Issue Tracking">
                                    <span class="none"></span>
                                    Issue Tracking</a>
                            </li>
                            <li>

                                <a href="project-license.html" title="Project License">
                                    <span class="none"></span>
                                    Project License</a>
                            </li>

                            <li>

                                <a href="dependency-repos.html" title="Dependency Repositories">
                                    <span class="none"></span>
                                    Dependency Repositories</a>
                            </li>


                            <li>

                                <a href="dependencyReport.html" title="Dependency Convergence">
                                    <span class="none"></span>
                                    Dependency Convergence</a>
                            </li>

                            <!-- maybe in the future
                                                        <li>

                                                            <a href="mail-lists.html" title="Mailing Lists">
                                                                <span class="none"></span>
                                                                Mailing Lists</a>
                                                        </li>

                                                        <li>

                                                            <a href="dependency-management.html" title="Dependency Management">
                                                                <span class="none"></span>
                                                                Dependency Management</a>
                                                        </li>


                            -->
                            <li>

                                <a href="https://travis-ci.org/osmdroid/osmdroid" title="Continuous Integration">
                                    <span class="none"></span>
                                    Continuous Integration</a>
                            </li>
                            <!--
                                                        <li>

                                                            <a href="plugins.html" title="Project Plugins">
                                                                <span class="none"></span>
                                                                Project Plugins</a>
                                                        </li>
                            -->
                            <li>

                                <a href="https://github.com/osmdroid/osmdroid/releases"
                                   title="Distribution Management">
                                    <span class="none"></span>
                                    Distribution Management</a>
                            </li>
                            <li>

                                <a href="javadoc.html" title="Project Reports">
                                    <span class="none"></span>
                                    Javadocs</a>

                            </li>

                            <li>

                                <a href="reports.html" title="Project Reports">
                                    <span class="none"></span>
                                    Project Reports</a>

                            </li>

                        </ul>
                    </li>


                </ul>


                <hr/>


            </div>
        </div>


        <div id="bodyColumn" class="span10">
            <a name="topOfPage"></a>
            <h1>Geopackage support for osmdroid</h1>
<p>NOTICE:</p>
<p>Geopackage support for osmdroid is still evolving. This guide may be out of date
or change frequently.</p>
<h2>What is Geopackage?</h2>
<p>Basically, it's a sqlite database that can contain:</p>
<ul>
<li>0 or more raster tile sources (think jpg, or png)</li>
<li>0 or more features sources (think vector graphics)</li>
</ul>
<p>Geopackage internally uses a different tile numbering system
than osmdroid or anything else based on the slippy tile format (z/x/y)
thus a support library is required in order to chop up, rearrange,
and transform whatever is in the geopackage database into
something more usable.</p>
<h2>Sources</h2>
<p>This code was adopted from NGA's Geopackage support library
and their adapter for Google Maps. Since the APIs between
Google Maps and Osmdroid are so similiar, much of the code was
used with only minor modifications.
<a href="https://github.com/ngageoint/geopackage-android">https://github.com/ngageoint/geopackage-android</a></p>
<h2>License</h2>
<p>This library: Inherited from the NGA code base
Dependencies: NGA code is MIT
See source code files for specific license info</p>
<h2>How to use</h2>
<p>Min SDK: 14</p>
<p>Add it your project</p>
<pre><code>compile 'org.osmdroid:osmdroid-geopackage:&lt;VERSION&gt;'
</code></pre>
<h3>Adding a geopackage raster tile set to the osmdroid map</h3>
<p>Note: this was added in 5.6.4</p>
<p>For a complete working example see:</p>
<p><a href="https://github.com/osmdroid/osmdroid/blob/master/OpenStreetMapViewer/src/main/java/org/osmdroid/samplefragments/tileproviders/GeopackageSample.java">https://github.com/osmdroid/osmdroid/blob/master/OpenStreetMapViewer/src/main/java/org/osmdroid/samplefragments/tileproviders/GeopackageSample.java</a></p>
<p>First let's up our map source, geopackage needs you to explicitly specify which map files to load</p>
<pre><code>
GeoPackageProvider.TileSourceBounds tileSourceBounds;
XYTileSource currentSource = null;
GeoPackageProvider geoPackageProvider = null;


//this bit does some basic file system scanning
Set&lt;File&gt; mapfiles = findMapFiles();
//do a simple scan of local storage for .gpkg files.
File[] maps = new File[mapfiles.size()];
maps = mapfiles.toArray(maps);
</code></pre>
<p>Set the tile provider</p>
<pre><code>geoPackageProvider = new GeoPackageProvider(maps, this.getContext());
mMapView.setTileProvider(geoPackageProvider);
</code></pre>
<p>Set the tile source by selecting a tile table in the geopackage database</p>
<pre><code>//get the list of sources
List&lt;GeoPackageMapTileModuleProvider.Container&gt; tileSources = geoPackageProvider.geoPackageMapTileModuleProvider().getTileSources();

//here we're keeping track of the current tile source so we can reference it later, primarly for
//displaying the bounds of the tile set
boolean sourceSet = false;
for (int i = 0; i &lt; tileSources.size(); i++) {
    //this is a list of geopackages, since we only support tile tables, pick the first one of those
    //ideally this should populate a spinner so that the user can select whatever tile source they want
    if (tileSources.get(i) != null &amp;&amp; !tileSources.get(i).tiles.isEmpty()) {
        currentSource = (XYTileSource) geoPackageProvider.getTileSource(tileSources.get(i).database,
            tileSources.get(0).tiles.get(i)
        );
        mMapView.setTileSource(currentSource);
        sourceSet = true;
        break;
    }
}

</code></pre>
<p>Finally, since you're probably looking at a grey grid, center the map where the tiles are</p>
<pre><code>tileSourceBounds = geoPackageProvider.getTileSourceBounds();
if (tileSourceBounds != null) {
    mMapView.zoomToBoundingBox(tileSourceBounds.bounds, true);
    mMapView.getController().setZoom(tileSourceBounds.minzoom);
}
</code></pre>
<h3>Adding a geopackage features to the osmdroid map</h3>
<p>Note: this was added after 5.6.5.</p>
<p>For smale feature sets, you can use the following code to convert all
features in a given geopackage feature table into osmdroid overlays (Marker, Polyline and Polygon).</p>
<p>Find our geopackages</p>
<pre><code>Set&lt;File&gt; mapfiles = findMapFiles();
//do a simple scan of local storage for .gpkg files.
File[] maps = new File[mapfiles.size()];
maps = mapfiles.toArray(maps);
</code></pre>
<p>Import them into the NGA manager</p>
<pre><code>// Get a manager
GeoPackageManager manager = GeoPackageFactory.getManager(getContext());

// Available databases
List&lt;String&gt; databases = manager.databases();

// Import database
for (File f : maps) {
    try {
        boolean imported = manager.importGeoPackage(f);
    } catch (Exception ex) {
        ex.printStackTrace();
    }
}
</code></pre>
<p>Start the conversion</p>
<pre><code>// Open database, we are assuming the first one is the one we want
// good place to ask the user
GeoPackage geoPackage = manager.open(databases.get(0));

OsmMapShapeConverter converter = new OsmMapShapeConverter(null);

// Feature tile tables
List&lt;String&gt; features = geoPackage.getFeatureTables();

// Query Features
// get the first table, this is an assumption, ask the user what they want

String featureTable = features.get(0);
FeatureDao featureDao = geoPackage.getFeatureDao(featureTable);
FeatureCursor featureCursor = featureDao.queryForAll();
try {
    while (featureCursor.moveToNext()) {
        try {
            FeatureRow featureRow = featureCursor.getRow();
            GeoPackageGeometryData geometryData = featureRow.getGeometry();
            Geometry geometry = geometryData.getGeometry();
            converter.addToMap(mMapView, geometry);
        } catch (Exception ex) {
            ex.printStackTrace();
        }
        // ...
    }
} finally {
    featureCursor.close();
}

</code></pre>
<h3>Adding a geopackage feature tile set to the osmdroid map</h3>
<p>This was added after 5.6.5</p>
<p>The following code opens a Geopackage database and adds 1 tile overlay to the map per feature tile table.</p>
<pre><code> // Get a manager
GeoPackageManager manager = GeoPackageFactory.getManager(getContext());

// Available databases
List&lt;String&gt; databases = manager.databases();

// Import database
for (File f : maps) {
	try {
		boolean imported = manager.importGeoPackage(f);
	} catch (Exception ex) {
		ex.printStackTrace();
	}
}

if (!databases.isEmpty()) {
	for (int k = 0; k &lt; databases.size(); k++) {
		// Open database
		GeoPackage geoPackage = manager.open(databases.get(k));
		// Feature tile tables
		List&lt;String&gt; features = geoPackage.getFeatureTables();
		// Query Features
		if (!features.isEmpty()) {
			for (int i = 0; i &lt; features.size(); i++) {
				GeoPackageFeatureTileProvider provider = new GeoPackageFeatureTileProvider(
					new XYTileSource(databases.get(k) + &quot;:&quot; + features.get(i),0,22,256,&quot;png&quot;,new String[0])
				);
				GeopackageFeatureTilesOverlay overlay = new GeopackageFeatureTilesOverlay(provider,getContext());
				overlay.setDatabaseAndFeatureTable(databases.get(k),  features.get(i));
				mMapView.getOverlayManager().add(overlay);
			}
		}
	}
}
</code></pre>


        </div>
        <div id="iframenav" style="visibility:hidden">
            <center><h3><a name="iframeAnchor"></a><a href="#topOfPage"> -- Top --</a></h3>
                <a href="javascript:popout();">Load in a new window</a>
            </center>
        </div>

        <iframe id="frame1" width="100%" height="75%" style="display:none"></iframe>



    </div>
</div>

<hr/>

<footer>
    <div class="container-fluid">
        <div class="row-fluid">
            <!-- footer -->
        </div>


    </div>
</footer>

<div class="modal hide fade" id="modal1">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Artifact Details</h3>
    </div>
    <div class="modal-body">
        <h3>Gradle</h3>
        <pre id="gradleDep">

        </pre>
        <h3>Maven</h3>
        <pre id="mavenDep">

        </pre>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal" >Close</a>
    </div>
</div>

<script type="text/javascript">

/**
*    opens the current iframe url in a new window or tab
*/
function popout(){
    var destination = $("#frame1").attr('src');
    var win = window.open(destination, '_blank');
    win.focus();
}

/**
*    displays a report and shows the iframe
*/
function showReport(url){
    $("#iframenav").css('visibility','');
    $("#frame1").show();
    $("#frame1").attr('src', url);
    $("#frame1").attr('height', window.innerHeight);
    window.location.assign("#iframeAnchor");
}

/**
* shows our maven/gradle helper modal
type is the file extension
*/
function showModal(group, artifact, version,type, classifier){

/**
if classifier and types
    foreach classifier
        foreach types
else if classifier
    foreach classifier
else if type
    foreah type
else
    just output it
*/
    //string outputs
    var maventxt ="";
    var gradle="";

    var hasClassifiers = classifier !== "" && classifier !== undefined;
    var hasTypes = type !== "" && type !== undefined;

    if (hasClassifiers && hasTypes){
        type = type.trim();
        var types = type.split(" ");
        classifier = classifier.trim();
        var classifiers = classifier.split(" ");
        for (var i = 0; i < types.length; i++) {
            if (types[i].trim().length==0)
                continue;
            for (var k = 0; k < classifiers.length; k++) {
                if (classifiers[k].trim().length==0)
                    continue;
                maventxt+= "<dependency>\n\t<groupId>" + group + "</groupId>\n\t<artifactId>" + artifact+
                    "</artifactId>\n\t";
                maventxt += "<type>" + types[i].trim() + "</type>\n\t";
                maventxt += "<classifier>" + classifiers[k].trim() + "</classifier>\n\t";
                maventxt +="<version>" + version + "</version>\n</dependency>\n";

                gradle += "compile '" + group + ":" + artifact + ":" + version;
                gradle += ":" + classifiers[k].trim();
                gradle += "@" + types[i];
                gradle += "'\n";
            }

        }


    } else if (hasClassifiers) {
        classifier = classifier.trim();
        var types = classifier.split(" ");
        for (var i = 0; i < types.length; i++) {
            if (types[i].trim().length==0)
                continue;
            maventxt+= "<dependency>\n\t<groupId>" + group + "</groupId>\n\t<artifactId>" + artifact+
                "</artifactId>\n\t";
            maventxt += "<classifier>" + types[i].trim() + "</classifier>\n\t";
            maventxt +="<version>" + version + "</version>\n</dependency>\n";

            gradle += "compile '" + group + ":" + artifact + ":" + version;
            gradle += ":" + types[i];
            gradle += "'\n";

        }
    } else if (hasTypes) {
        type = type.trim();
        var types = type.split(" ");
        for (var i = 0; i < types.length; i++) {
            if (types[i].trim().length==0)
                continue;
            maventxt+= "<dependency>\n\t<groupId>" + group + "</groupId>\n\t<artifactId>" + artifact+
                "</artifactId>\n\t";
            maventxt += "<type>" + types[i].trim() + "</type>\n\t";
            maventxt +="<version>" + version + "</version>\n</dependency>\n";

            gradle += "compile '" + group + ":" + artifact + ":" + version;
            gradle += "@" + types[i];
            gradle += "'\n";

        }
    } else {
            //no type or classifiers
         maventxt+= "<dependency>\n\t<groupId>" + group + "</groupId>\n\t<artifactId>" + artifact+
                "</artifactId>\n\t";
         maventxt +="<version>" + version + "</version>\n</dependency>\n";
         gradle += "compile '" + group + ":" + artifact + ":" + version;
         gradle += "'\n";

    }

    $("#mavenDep").text(maventxt);
    $("#gradleDep").text(gradle);
    $('#modal1').modal()

}

$("table").addClass("table table-striped sortable");
$(function () {
    setNavigation();
});


/**
* this sets the "active" bit on the left hand side naviation menu
*/
function setNavigation() {
    var path = window.location.pathname;
    path = path.replace(/\/$/, "");
    path = decodeURIComponent(path);
    var idx=path.toString().lastIndexOf("/");
    if (idx >= 0)
        path=path.substring(idx+1, path.length);

    $(".nav a").each(function () {
        var href = $(this).attr('href');
        if (path.substring(0, href.length) === href) {
            $(this).closest('li').addClass('active');
        }
    });
}
</script>
</body>
</html>
